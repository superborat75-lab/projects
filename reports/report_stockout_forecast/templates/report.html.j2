<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>–ü—Ä–æ–≥–Ω–æ–∑–∞ –∑–∞ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç–∏</title>
  <!-- Light, email-friendly styles. Avoid CSS variables, color-mix, sticky headers, and heavy layouts. -->
  <style>
    body { background:#ffffff; color:#111111; margin:0; padding:16px; font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.4; }
    h1 { margin:0 0 6px 0; font-size:20px; color:#111111; }
    .meta { color:#555555; margin:0 0 12px 0; }
    .legend { margin:10px 0 16px 0; color:#444444; }
    .legend .pill { display:inline-block; margin-right:10px; padding:4px 8px; border:1px solid #dddddd; border-radius:999px; background:#f7f7f7; }

    table { width:100%; border-collapse:collapse; }
    thead th { background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; }
    tbody td { padding:8px 10px; border:1px solid #eeeeee; vertical-align:top; }

    /* Fallback classes for clients that support <style>. Rows also receive inline background via Jinja for maximum compatibility. */
    tr.row-urgent { background:#fff5f6; }
    tr.row-attention { background:#fffbeb; }
    tr.row-ok { background:#ffffff; }

    .num { text-align:right; white-space:nowrap; font-variant-numeric: tabular-nums; }
    .date { white-space:nowrap; }

    .status-chip { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:bold; border:1px solid #cccccc; }
    .status-urgent { background:#fde8ea; color:#8a0b1a; border-color:#f3c4c9; }
    .status-attention { background:#fff4cc; color:#7a5a00; border-color:#f5dfa3; }
    .status-ok { background:#e9f9ef; color:#0b5d3e; border-color:#c7edd6; }

    /* Make table scrollable on small screens when viewed in browser */
    .table-wrap { overflow:auto; -webkit-overflow-scrolling:touch; border:1px solid #e6e6e6; border-radius:6px; }
  </style>
</head>
<body style="background:#ffffff; color:#111111; margin:0; padding:16px; font-family: Arial, Helvetica, sans-serif; font-size:14px; line-height:1.4;">
  <h1 style="margin:0 0 6px 0; font-size:20px; color:#111111;">–ü—Ä–æ–≥–Ω–æ–∑–∞ –∑–∞ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç–∏</h1>
  <div class="meta" style="color:#555555; margin:0 0 12px 0;">
    –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω: {{ generated_at }} ¬∑ –•–æ—Ä–∏–∑–æ–Ω—Ç: {{ horizon_days }} –¥–Ω–∏ ¬∑ –û–±—â–æ lead time: {{ lead_total_days }} –¥–Ω–∏ ¬∑ –û–±—â–æ –∞—Ä—Ç–∏–∫—É–ª–∏: {{ count_total }} ¬∑ üü• {{ count_urgent }} ¬∑ üü® {{ count_attention }} ¬∑ üü© {{ count_ok }}
  </div>
  <div class="legend" style="margin:10px 0 16px 0; color:#444444;">
    <span class="pill" style="display:inline-block; margin-right:10px; padding:4px 8px; border:1px solid #dddddd; border-radius:999px; background:#f7f7f7;">üü• –ò–∑—á–µ—Ä–ø–≤–∞–Ω–µ ‚â§ –æ–±—â lead time (—Å–ø–µ—à–Ω–æ)</span>
    <span class="pill" style="display:inline-block; margin-right:10px; padding:4px 8px; border:1px solid #dddddd; border-radius:999px; background:#f7f7f7;">üü® –ò–∑—á–µ—Ä–ø–≤–∞–Ω–µ –≤ —Ä–∞–º–∫–∏—Ç–µ –Ω–∞ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞ (–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ)</span>
    <span class="pill" style="display:inline-block; margin-right:10px; padding:4px 8px; border:1px solid #dddddd; border-radius:999px; background:#f7f7f7;">üü© –ù—è–º–∞ —Ä–∏—Å–∫ (ok)</span>
  </div>

  <div class="table-wrap" style="overflow:auto; -webkit-overflow-scrolling:touch; border:1px solid #e6e6e6; border-radius:6px;">
    <table role="table" aria-label="–ü—Ä–æ–≥–Ω–æ–∑–∞ –∑–∞ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ –Ω–∞ –Ω–∞–ª–∏—á–Ω–æ—Å—Ç–∏" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd;">–°—Ç–∞—Ç—É—Å</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd;">–ö–æ–¥</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd;">–ê—Ä—Ç–∏–∫—É–ª</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; white-space:nowrap;">–ù–∞–ª–∏—á–Ω–æ—Å—Ç</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; white-space:nowrap;">–°—Ä–µ–¥–Ω–æ–¥–Ω–µ–≤–Ω–∏</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; white-space:nowrap;">–ú–µ—Å–µ—Ü–∏ –¥–æ —Å–≤—ä—Ä—à–≤–∞–Ω–µ</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; white-space:nowrap;">–î–∞—Ç–∞ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ</th>
          <th style="background:#f5f5f5; color:#222222; text-align:center; padding:8px 10px; border:1px solid #dddddd; white-space:nowrap;">–î–∞—Ç–∞ –ø–æ—Ä—ä—á–∫–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for r in forecast %}
        {% set st = (r.status or 'ok') %}
        {% set row_bg = '#ffffff' %}
        {% if st == 'urgent' %}{% set row_bg = '#fff5f6' %}{% elif st == 'attention' %}{% set row_bg = '#fffbeb' %}{% else %}{% set row_bg = '#ffffff' %}{% endif %}
        <tr class="row-{{ st }}" style="background: {{ row_bg }};">
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center;">
            {% if st == 'urgent' %}
            <span class="status-chip status-urgent" style="display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:bold; background:#fde8ea; color:#8a0b1a; border:1px solid #f3c4c9;">–°–ø–µ—à–Ω–æ</span>
            {% elif st == 'attention' %}
            <span class="status-chip status-attention" style="display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:bold; background:#fff4cc; color:#7a5a00; border:1px solid #f5dfa3;">–í–Ω–∏–º–∞–Ω–∏–µ</span>
            {% else %}
            <span class="status-chip status-ok" style="display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:bold; background:#e9f9ef; color:#0b5d3e; border:1px solid #c7edd6;">OK</span>
            {% endif %}
          </td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center;">{{ r.sku }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center;">{{ r.item_name }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center; white-space:nowrap;">{{ r.on_hand | int_space }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center; white-space:nowrap;">{{ r.avg_daily | fmt_int }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center; white-space:nowrap;">{{ r.days_of_stock is not none and (r.days_of_stock | days_to_months) or '‚Äî' }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center; white-space:nowrap;">{{ r.depletion_date | fmt_date }}</td>
          <td style="padding:8px 10px; border:1px solid #eeeeee; text-align:center; white-space:nowrap;">{{ r.order_date | fmt_date }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>